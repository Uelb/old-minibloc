!function(e){function t(e){var t,i=e.originalEvent.changedTouches,a=i[0],r="";switch(e.type){case"touchmove":r="mousemove";break;case"touchend":r="mouseup";break;default:return}t=document.createEvent("MouseEvent"),t.initMouseEvent(r,!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(t),e.preventDefault()}e.fn.rateit=function(i,a){var r,n={},s="init",d=function(e){return e.charAt(0).toUpperCase()+e.substr(1)};if(0==this.length)return this;if(r=e.type(i),"object"==r||void 0===i||null==i)n=e.extend({},e.fn.rateit.defaults,i);else{if("string"==r&&void 0===a)return this.data("rateit"+d(i));"string"==r&&(s="setvalue")}return this.each(function(){var r,l,h,o,u,c,v,f=e(this),g=function(e){return arguments[0]="rateit"+d(e),f.data.apply(f,arguments)};if(f.hasClass("rateit")||f.addClass("rateit"),r="rtl"!=f.css("direction"),"setvalue"==s){if(!g("init"))throw"Can't set value before init";"readonly"!=i||g("readonly")||(f.find(".rateit-range").unbind(),g("wired",!1)),"value"==i&&null==a&&(a=g("min")),g("backingfld")&&(l=e(g("backingfld")),"value"==i&&l.val(a),"min"==i&&l[0].min&&(l[0].min=a),"max"==i&&l[0].max&&(l[0].max=a),"step"==i&&l[0].step&&(l[0].step=a)),g(i,a)}g("init")||(g("min",g("min")||n.min),g("max",g("max")||n.max),g("step",g("step")||n.step),g("readonly",void 0!==g("readonly")?g("readonly"):n.readonly),g("resetable",void 0!==g("resetable")?g("resetable"):n.resetable),g("backingfld",g("backingfld")||n.backingfld),g("starwidth",g("starwidth")||n.starwidth),g("starheight",g("starheight")||n.starheight),g("value",g("value")||n.value||n.min),g("ispreset",void 0!==g("ispreset")?g("ispreset"):n.ispreset),g("backingfld")&&(l=e(g("backingfld")),g("value",l.hide().val()),(l.attr("disabled")||l.attr("readonly"))&&g("readonly",!0),"INPUT"==l[0].nodeName&&("range"==l[0].type||"text"==l[0].type)&&(g("min",parseInt(l.attr("min"))||g("min")),g("max",parseInt(l.attr("max"))||g("max")),g("step",parseInt(l.attr("step"))||g("step"))),"SELECT"==l[0].nodeName&&l[0].options.length>1&&(g("min",Number(l[0].options[0].value)),g("max",Number(l[0].options[l[0].length-1].value)),g("step",Number(l[0].options[1].value)-Number(l[0].options[0].value)))),f.append('<div class="rateit-reset"></div><div class="rateit-range"><div class="rateit-selected" style="height:'+g("starheight")+'px"></div><div class="rateit-hover" style="height:'+g("starheight")+'px"></div></div>'),r||(f.find(".rateit-reset").css("float","right"),f.find(".rateit-selected").addClass("rateit-selected-rtl"),f.find(".rateit-hover").addClass("rateit-hover-rtl")),g("init",!0)),h=f.find(".rateit-range"),h.width(g("starwidth")*(g("max")-g("min"))).height(g("starheight")),o="rateit-preset"+(r?"":"-rtl"),g("ispreset")?f.find(".rateit-selected").addClass(o):f.find(".rateit-selected").removeClass(o),null!=g("value")&&(u=(g("value")-g("min"))*g("starwidth"),f.find(".rateit-selected").width(u)),c=f.find(".rateit-reset"),c.data("wired")!==!0&&c.click(function(){g("value",g("min")),h.find(".rateit-hover").hide().width(0),h.find(".rateit-selected").width(0).show(),g("backingfld")&&e(g("backingfld")).val(g("min")),f.trigger("reset")}).data("wired",!0),v=function(t,i){var a=i.changedTouches?i.changedTouches[0].pageX:i.pageX,n=a-e(t).offset().left;return r||(n=h.width()-n),n>h.width()&&(n=h.width()),0>n&&(n=0),u=Math.ceil(n/g("starwidth")*(1/g("step")))},g("readonly")?c.hide():(g("resetable")||c.hide(),g("wired")||(h.bind("touchmove touchend",t),h.mousemove(function(e){var t,i=v(this,e),a=i*g("starwidth")*g("step"),r=h.find(".rateit-hover");r.data("width")!=a&&(h.find(".rateit-selected").hide(),r.width(a).show().data("width",a),t=[i*g("step")+g("min")],f.trigger("hover",t).trigger("over",t))}),h.mouseleave(function(){h.find(".rateit-hover").hide().width(0).data("width",""),f.trigger("hover",[null]).trigger("over",[null]),h.find(".rateit-selected").show()}),h.mouseup(function(t){var i=v(this,t),a=i*g("step")+g("min");g("value",a),g("backingfld")&&e(g("backingfld")).val(a),g("ispreset")&&(h.find(".rateit-selected").removeClass(o),g("ispreset",!1)),h.find(".rateit-hover").hide(),h.find(".rateit-selected").width(i*g("starwidth")*g("step")).show(),f.trigger("hover",[null]).trigger("over",[null]).trigger("rated",[a])}),g("wired",!0)),g("resetable")&&c.show())})},e.fn.rateit.defaults={min:0,max:5,step:.5,starwidth:16,starheight:16,readonly:!1,resetable:!0,ispreset:!1},e(function(){e("div.rateit").rateit()})}(jQuery);